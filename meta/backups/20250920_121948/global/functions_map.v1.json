{
  "version": "1.7.0",
  "updated_at": "2025-09-15",
  "modules": [
    {
      "name": "AppShell",
      "type": "layout",
      "responsibilities": [
        "Two-pane layout (sidebar + content) on desktop; topnav + drawer on mobile.",
        "Renders TopBanner and routes module content based on active module."
      ],
      "inputs": ["active_module", "theme tokens"],
      "outputs": ["composed layout"],
      "extension_notes": [
        "Adding a new module should be append-only; avoid touching existing module internals."
      ]
    },
    {
      "name": "TopBanner",
      "type": "shared_component",
      "responsibilities": [
        "Show 'Geronimo' brand (title) and optional subtitle or actions.",
        "Identical look across modules."
      ],
      "inputs": ["theme tokens"],
      "outputs": ["header UI"]
    },
    {
      "name": "Sidebar",
      "type": "shared_component",
      "responsibilities": [
        "Desktop navigation with icons + labels.",
        "Supports expanded and collapsed states with transition."
      ],
      "inputs": ["items", "active_module", "collapsed"],
      "outputs": ["module change events"],
      "actions": ["toggleSidebar"]
    },
    {
      "name": "MobileDrawer",
      "type": "shared_component",
      "responsibilities": [
        "Same menu as Sidebar presented as a drawer from the left.",
        "Implements focus trap; ESC closes."
      ],
      "inputs": ["items", "active_module", "open"],
      "outputs": ["module change events", "close event"],
      "actions": ["openDrawer", "closeDrawer"]
    },
    {
      "name": "TopNav",
      "type": "shared_component",
      "responsibilities": [
        "Hamburger on mobile to open MobileDrawer; right-side actions slot."
      ],
      "inputs": ["onHamburger"],
      "outputs": ["open drawer"]
    },
    {
      "name": "TodosPage",
      "type": "page",
      "responsibilities": [
        "Manage todos state with caching and staged changes system.",
        "Provide inline editing with keyboard navigation support.",
        "Handle category-based filtering and multi-column sorting.",
        "Implement staging system for batch operations before saving.",
        "Integrate with webhook API with fallback to mock data.",
        "Provide accessibility features and screen reader support.",
        "Compose CategoryTabs and TodosTable components."
      ],
      "inputs": ["seed todos", "ApiClient", "Storage", "Webhook API"],
      "outputs": ["UI, optimistic updates", "staged changes", "cached data"]
    },
    {
      "name": "CategoryTabs",
      "type": "shared_component",
      "responsibilities": [
        "Derive unique categories from provided todos dynamically.",
        "Render tabs: All + each category with proper styling.",
        "Emit selected category change events.",
        "Handle responsive design for mobile and desktop.",
        "Provide accessibility support with proper ARIA attributes."
      ],
      "inputs": ["todos", "active_category", "theme_tokens"],
      "outputs": ["category change events"],
      "extension_notes": [
        "Must not hardcode category list - derive from data.",
        "Supports keyboard navigation and screen readers."
      ]
    },
    {
      "name": "TodosTable",
      "type": "shared_component",
      "responsibilities": [
        "Render bordered zebra table with sticky header and responsive design.",
        "Support multi-column sorting by created_at and priority (high>medium>low>null).",
        "Provide inline editing for task, category, and priority fields.",
        "Handle row addition, completion, and deletion operations.",
        "Implement keyboard navigation and accessibility features.",
        "Support real-time search filtering across all fields.",
        "Display priority badges and status indicators with proper styling."
      ],
      "inputs": ["rows", "onChange handlers", "sort state", "filter term", "editing state"],
      "outputs": ["row updates", "row adds", "row completes", "edit events"],
      "extension_notes": [
        "Default sort comes from scope (priority desc, then created_at desc).",
        "Editable cells support keyboard nav: Tab/Shift+Tab to move, Enter to commit, Esc to cancel.",
        "Status field is UI-only and not exported; ID is internal-only and not displayed.",
        "Supports screen readers with proper ARIA attributes and live announcements."
      ]
    },
    {
      "name": "IdeasPage",
      "type": "page",
      "responsibilities": [
        "Manage ideas state with caching and staged changes system.",
        "Provide inline editing with field-specific input types.",
        "Handle category-based filtering and sorting capabilities.",
        "Implement staging system for batch operations before saving.",
        "Integrate with webhook API with fallback to mock data.",
        "Provide accessibility features and screen reader support.",
        "Support multiline notes with dynamic height expansion.",
        "Compose IdeasCategoryTabs and IdeasTable components."
      ],
      "inputs": ["seed ideas", "ApiClient", "Storage", "Webhook API"],
      "outputs": ["UI, optimistic updates", "staged changes", "cached data"]
    },
    {
      "name": "TimeTrackingPage",
      "type": "page",
      "responsibilities": [
        "Start/stop/continue timer with elapsed time preservation.",
        "Manual time entry with separate hour/minute inputs and validation.",
        "Auto-switch chart category when adding time within current period.",
        "Real-time timer display with proper state management.",
        "Form validation preventing double-submission and invalid inputs.",
        "Chart filtering by category and time period (week/month/year).",
        "Session persistence with localStorage and webhook integration.",
        "Toast notifications for user feedback and error handling."
      ],
      "inputs": ["seed sessions", "ApiClient", "Storage", "TimeUtils", "TimerContext"],
      "outputs": ["UI, optimistic updates", "chart updates", "timer state"]
    },
    {
      "name": "IdeasCategoryTabs",
      "type": "shared_component",
      "responsibilities": [
        "Derive unique categories from provided ideas dynamically.",
        "Render tabs: All + each category with proper styling.",
        "Emit selected category change events.",
        "Handle responsive design for mobile and desktop.",
        "Provide accessibility support with proper ARIA attributes."
      ],
      "inputs": ["ideas", "active_category", "theme_tokens"],
      "outputs": ["category change events"],
      "extension_notes": [
        "Must not hardcode category list - derive from data.",
        "Supports keyboard navigation and screen readers."
      ]
    },
    {
      "name": "IdeasTable",
      "type": "shared_component",
      "responsibilities": [
        "Render bordered zebra table with sticky header and responsive design.",
        "Support sorting by created_at and other fields.",
        "Provide inline editing for idea, category, and notes fields.",
        "Handle row addition, removal, and editing operations.",
        "Implement keyboard navigation and accessibility features.",
        "Support real-time search filtering across all fields.",
        "Display field-specific input types (text, select, textarea).",
        "Handle multiline notes with dynamic height expansion."
      ],
      "inputs": ["rows", "onChange handlers", "sort state", "filter term", "editing state"],
      "outputs": ["row updates", "row adds", "row removes", "edit events"],
      "extension_notes": [
        "Default sort comes from scope (created_at desc).",
        "Editable cells support keyboard nav: Tab/Shift+Tab to move, Enter to commit, Esc to cancel.",
        "Status field is UI-only and not exported; ID is internal-only and not displayed.",
        "Supports screen readers with proper ARIA attributes and live announcements.",
        "Notes field uses textarea with dynamic height adjustment."
      ]
    },
    {
      "name": "TimerCard",
      "type": "shared_component",
      "responsibilities": [
        "Show running time; start/stop controls; state display."
      ],
      "inputs": ["running", "elapsed_ms"],
      "outputs": ["start", "stop"]
    },
    {
      "name": "SessionEditor",
      "type": "shared_component",
      "responsibilities": [
        "Edit duration and notes before confirming."
      ],
      "inputs": ["session draft"],
      "outputs": ["confirm", "cancel"]
    },
    {
      "name": "ThemeConfig",
      "type": "utility",
      "file": "/src/theme/config.ts",
      "responsibilities": [
        "Export tokens mirroring /meta/style_profile.json.",
        "Provide cn() helper for conditional className composition."
      ],
      "exports": ["tokens", "cn"]
    },
    {
      "name": "ApiClient",
      "type": "utility",
      "file": "/src/lib/api.ts",
      "responsibilities": [
        "Mock-only: delay ~300ms and return success for Save/Submit/Complete.",
        "Provide full-file API for todos: postTodosFile(payload: TodoFileItem[]).",
        "Keep delta API available but unused by Save."
      ],
      "exports": ["postToBackend", "postComplete", "postTodosBatch", "postTodosFile"]
    },
    {
      "name": "Storage",
      "type": "utility",
      "file": "/src/lib/storage.ts",
      "responsibilities": [
        "Get/set todos and sessions from in-memory with optional localStorage mirror.",
        "Transform todos on read: ensure priority (null), ignore status, ensure id (uuid), set statusUi default.",
        "Add helpers: addTodo (sets id, created_at, priority).",
        "Provide staging: stageRowEdit, stageComplete, getStagedChanges, clearStagedChanges."
      ],
      "exports": [
        "getTodos",
        "setTodos",
        "getSessions",
        "setSessions",
        "addTodo",
        "completeTodo",
        "stageRowEdit",
        "stageComplete",
        "getStagedChanges",
        "clearStagedChanges",
        "getWorkingTodos",
        "serializeTodosForExport",
        "applyFileSave"
      ]
    },
    {
      "name": "TimeUtils",
      "type": "utility",
      "file": "/src/lib/time.ts",
      "responsibilities": [
        "nowIso, msToHms, computeDurationMs and related helpers."
      ],
      "exports": ["nowIso", "msToHms", "computeDurationMs", "formatDateTime"]
    },
    {
      "name": "TimerContext",
      "type": "context",
      "file": "/src/contexts/TimerContext.tsx",
      "responsibilities": [
        "Cross-tab timer state management with localStorage sync.",
        "Provide active session state and elapsed time to components.",
        "Handle timer ticking and state updates across tab visibility changes."
      ],
      "exports": ["TimerProvider", "useTimer", "activeSession", "elapsedMs", "setActive", "resetElapsed"]
    }
  ],
  "navigation": {
    "items": [
      { "id": "todos", "label": "To-Dos", "icon": "check-square" },
      { "id": "ideas", "label": "Ideas", "icon": "lightbulb" },
      { "id": "time_tracking", "label": "Time Tracking", "icon": "timer" }
    ],
    "default_item_id": "todos"
  },
  "routes": [
    { "id": "todos", "surface": "module", "component": "TodosPage" },
    { "id": "ideas", "surface": "module", "component": "IdeasPage" },
    { "id": "time_tracking", "surface": "module", "component": "TimeTrackingPage" }
  ],
  "notifications": {
    "toast_api": [
      "toast.success(message, ttlMs?)",
      "toast.error(message, ttlMs?)",
      "toast.info(message, ttlMs?)"
    ],
    "host_component": "ToastHost (mounted once in AppShell)",
    "guarantees": [
      "Single host instance",
      "ARIA polite announcements",
      "Theme tokens only"
    ]
  },
  "state_shapes": [
    {
      "name": "Todo",
      "fields": [
        "id: number|string",
        "task: string",
        "status: string",
        "category: string",
        "created_at: string"
      ]
    },
    {
      "name": "Session",
      "fields": [
        "id: string",
        "started_at: string",
        "ended_at?: string",
        "duration_ms: number",
        "note?: string"
      ]
    },
    {
      "name": "Idea",
      "fields": [
        "id: string",
        "idea: string",
        "category: string",
        "notes: string",
        "created_at: string",
        "status: string"
      ]
    }
  ],
  "actions": [
    { "name": "addTodo", "in": "TodosPage", "payload": { "todo": "Todo" } },
    { "name": "editTodo", "in": "TodosTable", "payload": { "todo": "Todo" } },
    { "name": "deleteTodo", "in": "TodosTable", "payload": { "id": "number|string" } },
    { "name": "saveTodos", "in": "TodosPage", "payload": { "todos": "Todo[]" } },
    { "name": "addIdea", "in": "IdeasPage", "payload": { "idea": "Idea" } },
    { "name": "editIdea", "in": "IdeasTable", "payload": { "idea": "Idea" } },
    { "name": "removeIdea", "in": "IdeasTable", "payload": { "id": "string" } },
    { "name": "saveIdeas", "in": "IdeasPage", "payload": { "ideas": "Idea[]" } },
    { "name": "commitIdeaEdit", "in": "IdeasTable", "payload": { "id": "string", "patch": "IdeaPatch" } },
    { "name": "startTimer", "in": "TimeTrackingPage", "payload": { "category": "string" } },
    { "name": "stopTimer", "in": "TimeTrackingPage", "payload": {} },
    { "name": "continueTimer", "in": "TimeTrackingPage", "payload": {} },
    { "name": "resetTimer", "in": "TimeTrackingPage", "payload": {} },
    { "name": "addManualSession", "in": "TimeTrackingPage", "payload": { "date": "string", "category": "string", "hours": "number", "minutes": "number" } },
    { "name": "submitPendingSession", "in": "TimeTrackingPage", "payload": { "session": "Session" } },
    { "name": "selectChartCategory", "in": "TimeTrackingPage", "payload": { "category": "string" } },
    { "name": "setTimePeriod", "in": "TimeTrackingPage", "payload": { "period": "week|month|ytd" } },
    { "name": "appendSession", "in": "TimeTrackingPage", "payload": { "session": "Session" } },
    { "name": "editSession", "in": "SessionEditor", "payload": { "session": "Session" } },
    { "name": "deleteSession", "in": "TimeTrackingPage", "payload": { "id": "string" } },
    { "name": "submitSessions", "in": "TimeTrackingPage", "payload": { "sessions": "Session[]" } },
    { "name": "stageRowEdit", "in": "TodosPage", "payload": { "id": "string", "patch": "Partial<Todo> including statusUi" } },
    { "name": "stageComplete", "in": "TodosPage", "payload": { "id": "string" } },
    { "name": "applyBatch", "in": "TodosPage", "payload": { "updates": "TodoPatch[]", "completes": "string[]" } },
    { "name": "clearStagedChanges", "in": "TodosPage", "payload": {} }
  ],
  "guardrails_for_agent": [
    "Do not modify /meta/*.",
    "Do not hardcode category values; derive from data.",
    "Keep changes small and reversible; prefer additive files."
  ],
  "verification_checklist": [
    "Sidebar works (expand/collapse) on desktop with tooltip labels in collapsed mode; Mobile drawer opens/closes with focus trap and ESC.",
    "To-Dos shows All + per-category tabs derived from dataset; default sort created_at desc; ID generation uses uuid; table styled and interactive with keyboard editing.",
    "Time Tracking: timer and session list work locally; Submit mocked.",
    "Theme tokens are used consistently across modules."
  ]
}
  